<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì´ë¼ë„¤ ì†”ë­ - ë¯¸ë‹ˆë§µ ëª¨ë“œ</title>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@700;900&family=Orbitron:wght@700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
    /* ë¯¸ë‹ˆë§µ í¬ê¸° ìµœì í™” (ê°€ë¡œ ì•½ 300px íƒ€ê²Ÿ) */
    body { margin: 0; background: transparent; color: #fff; font-family: 'Pretendard', sans-serif; overflow: hidden; }
    
    /* ì „ì²´ ì»¨í…Œì´ë„ˆ: ê²€ì€ ë°°ê²½ ì ìš© ë° í¬ê¸° ì œí•œ */
    .mini-overlay {
        width: 320px; 
        background: #000000; /* ê²€ì€ ë°°ê²½ */
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        padding: 8px;
        box-sizing: border-box;
    }

    /* ìƒë‹¨ ìš”ì•½ ì •ë³´ */
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 4px; }
    .header .title { font-family: 'Orbitron', sans-serif; font-size: 12px; color: #00FFAA; }
    .header .total-score { font-size: 12px; font-weight: 900; }
    .header .total-score .win { color: #ffd369; }
    .header .total-score .lose { color: #ff6b6b; }

    /* íŒ€ ì„¹ì…˜ */
    .team-section { display: flex; flex-direction: column; gap: 4px; }
    .team-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; }

    /* ë©¤ë²„ ì¹´ë“œ - ì´ˆìŠ¬ë¦¼ ë²„ì „ */
    .m-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
        padding: 4px 0;
        position: relative;
        border: 1px solid #222;
    }
    .m-card.red { border-bottom: 2px solid #ff5c5c; }
    .m-card.blue { border-bottom: 2px solid #4db8ff; }

    /* ë‹‰ë„¤ì„ (ìµœì†Œí™”) */
    .m-name { font-size: 9px; font-weight: 800; width: 100%; text-align: center; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; margin-bottom: 3px; }
    
    /* ì±”í”¼ì–¸ ì•„ì´ì½˜ */
    .m-champ { position: relative; width: 34px; height: 34px; border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden; background: #111; }
    .m-champ img { width: 100%; height: 100%; object-fit: cover; }

    /* ì „ì  (W/L) */
    .m-score { font-size: 10px; font-weight: 900; margin-top: 2px; }
    .m-score .w { color: #ffd369; }
    .m-score .l { color: #ff6b6b; }

    /* ì—°ìŠ¹/ì—°íŒ¨ ë°°ì§€ (ì•„ì´ì½˜ ìœ„) */
    .m-badge { position: absolute; top: 12px; right: -2px; font-size: 14px; z-index: 10; pointer-events: none; }
    
    /* íƒ€ì´ë¨¸ (í•˜ë‹¨ ì‘ê²Œ) */
    .timer-bar { font-size: 10px; text-align: center; margin-top: 6px; color: #aaa; font-weight: 700; }
</style>
</head>
<body>

<div class="mini-overlay">
    <div class="header">
        <span class="title">SOLO RANK BET</span>
        <div class="total-score" id="total-score">
            <span class="win">0W</span> / <span class="lose">0L</span>
        </div>
    </div>
    
    <div class="team-section">
        <div class="team-row" id="player-list">
            </div>
    </div>

    <div class="timer-bar" id="timer-display">ë‚¨ì€ì‹œê°„ 00:00:00</div>
</div>

<script>
const SUPABASE_URL = "https://hsvknfmnsehwytnvaiwr.supabase.co";
const SUPABASE_KEY = "sb_publishable_l2wj1IeGSfcxgKVjJ28n0w_WK9iHm-j";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const LOL_VER = "16.3.1"; // ìš”ì²­í•˜ì‹  ë²„ì „ ë°˜ì˜

async function loadData() {
    try {
        const { data: sData } = await sb.from('settings').select('*');
        const { data: pData } = await sb.from('players').select('*').order('created_at', { ascending: true });
        
        if (pData) {
            let totalW = 0, totalL = 0;
            const list = document.getElementById('player-list');
            list.innerHTML = pData.map(p => {
                totalW += (p.wins || 0);
                totalL += (p.losses || 0);
                
                // ìµœê·¼ ì±”í”¼ì–¸ ê°€ì ¸ì˜¤ê¸°
                const cName = p.champions && p.champions[0] ? p.champions[0] : 'None';
                const imgSrc = cName === 'None' 
                    ? 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7' 
                    : `https://ddragon.leagueoflegends.com/cdn/${LOL_VER}/img/champion/${cName}.png`;
                
                // ì—°ìŠ¹/ì—°íŒ¨ ì•„ì´ì½˜ íŒë‹¨
                let badge = '';
                if (p.streak >= 3) badge = 'ğŸ”¥';
                else if (p.streak <= -3) badge = 'ğŸ’€';

                return `
                    <div class="m-card ${p.team}">
                        <div class="m-name">${p.name}</div>
                        <div class="m-champ">
                            <img src="${imgSrc}" onerror="this.src='https://ddragon.leagueoflegends.com/cdn/${LOL_VER}/img/profileicon/29.png'">
                            <div class="m-badge">${badge}</div>
                        </div>
                        <div class="m-score">
                            <span class="w">${p.wins}</span>:<span class="l">${p.losses}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('total-score').innerHTML = `<span class="win">${totalW}W</span> / <span class="lose">${totalL}L</span>`;
        }
        
        if (sData && sData[0]) {
            updateTimer(sData[0].timer_end_at);
        }
    } catch (e) { console.error("Error:", e); }
}

function updateTimer(endTime) {
    if (!endTime) return;
    const diff = new Date(endTime).getTime() - new Date().getTime();
    const el = document.getElementById('timer-display');
    if (diff <= 0) { el.textContent = "ì†”ë­ ë‚´ê¸° ì¢…ë£Œ"; return; }
    const h = String(Math.floor(diff / 3600000)).padStart(2, '0');
    const m = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
    const s = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');
    el.textContent = `ë‚¨ì€ì‹œê°„ ${h}:${m}:${s}`;
}

// ì´ˆê¸°í™” ë° ì‹¤ì‹œê°„ êµ¬ë…
loadData();
setInterval(loadData, 60000); 
sb.channel('any').on('postgres_changes',{event:'*',schema:'public',table:'players'},loadData).subscribe();
sb.channel('any').on('postgres_changes',{event:'*',schema:'public',table:'settings'},loadData).subscribe();
</script>
</body>
</html>














































