<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì†”ë­ ë‚´ê¸° ì†¡ì¶œ íŒ¨ë„</title>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@600;800&family=Orbitron:wght@600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body {
  margin:0;
  background:#000;
  color:#fff;
  font-family:'Pretendard',sans-serif;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  height:100vh;
}

.container {
  display:flex;
  justify-content:center;
  align-items:flex-start;
  gap:40px;
}

/* íŒ€ ì˜ì—­ */
.team {
  display:flex;
  flex-direction:column;
  align-items:center;
}

.red h1{ color:#ff5c5c; font-size:52px; }
.blue h1{ color:#4db8ff; font-size:52px; }

.team h1 {
  text-align:center;
  margin-bottom:14px;
  letter-spacing:2px;
  font-family:'Orbitron',sans-serif;
}

/* ìš”ì•½ */
.summary {
  text-align:center;
  font-size:28px;
  margin-bottom:12px;
  font-family:'Orbitron',sans-serif;
  animation:scoreGlow 1.4s infinite;
}

@keyframes scoreGlow{
  0%,100%{text-shadow:0 0 6px #fff; opacity:0.8;}
  50%{text-shadow:0 0 16px #fff; opacity:1;}
}

/* ë©¤ë²„ ì¹´ë“œ */
.members {
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
}

/* 1. ì¹´ë“œ ë³¸ì²´: ë†’ì´ë¥¼ ì§ì ‘ ì œí•œí•˜ê±°ë‚˜ íŒ¨ë”©ì„ ê·¹ë‹¨ì ìœ¼ë¡œ ì¤„ì„ */
.member-card {
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 4px 10px;        /* ìœ„ì•„ë˜ íŒ¨ë”© 4pxë¡œ ê·¹ì¶•ì†Œ */
  width: 180px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0px;                 /* ê°„ê²© 0ìœ¼ë¡œ ì„¤ì • */
  min-height: 0;            /* ìµœì†Œ ë†’ì´ í•´ì œ */
  overflow: hidden;         /* ë„˜ì¹˜ëŠ” ë¶€ë¶„ ì°¨ë‹¨ */
}

/* 2. ì´ë¦„ ì˜ì—­: ì¤„ê°„ê²©(line-height)ê³¼ ë§ˆì§„ ì œê±° */
.name {
  font-weight: 800;
  font-family: 'Orbitron', sans-serif;
  font-size: 16px;
  margin: 0 !important;
  line-height: 1.1;         /* ì¤„ê°„ê²©ì„ 1.1ë¡œ ì¡°ì ˆ */
  padding: 2px 0;
}

/* 3. ìŠ¹íŒ¨ ê¸°ë¡: í°íŠ¸ í¬ê¸° ì¤„ì´ê³  ë§ˆì§„ ì œê±° */
.record {
  display: flex;
  justify-content: center;
  gap: 4px;
  font-weight: 700;
  font-size: 13px;          /* 16px -> 13px */
  margin: 0 !important;
  line-height: 1;
}

/* 4. ìµœê·¼ ì „ì : ì (Dot) í¬ê¸° ì¶•ì†Œ */
.recent {
  display: flex;
  justify-content: center;
  gap: 3px;
  margin: 2px 0 !important; /* ìœ„ì•„ë˜ ì—¬ë°± ìµœì†Œí™” */
}

.recent-dot {
  width: 10px;              /* 18px -> 10px (ì´ê²Œ í¬ë©´ ì„¸ë¡œê°€ í™• ëŠ˜ì–´ë‚¨) */
  height: 10px;
  border-radius: 50%;
}

/* 5. ì±”í”¼ì–¸ ì•„ì´ì½˜: ê°€ì¥ í° ë²”ì¸! */
.champions {
  display: flex;
  justify-content: center;
  gap: 2px;
  margin-top: 2px !important;
}

.champions img {
  width: 24px;              /* 32px -> 24px (ì•„ì´ì½˜ì´ ë†’ì´ì˜ í•µì‹¬ì…ë‹ˆë‹¤) */
  height: 24px;
  border-radius: 3px;
}

/* 6. ì—°ìŠ¹/ì—°íŒ¨ í…ìŠ¤íŠ¸ */
.streak {
  font-size: 12px;          /* ì‘ê²Œ ì¡°ì ˆ */
  margin-left: 3px;
}
</style>
</head>
<body>
<div class="container">
  <div class="team red">
    <h1 id="redName">RED TEAM</h1>
    <div class="summary" id="redSummary"></div>
    <div class="members" id="redPlayers"></div>
  </div>
  <div class="team blue">
    <h1 id="blueName">BLUE TEAM</h1>
    <div class="summary" id="blueSummary"></div>
    <div class="members" id="bluePlayers"></div>
  </div>
</div>

<script>
const SUPABASE_URL = "https://hsvknfmnsehwytnvaiwr.supabase.co";
const SUPABASE_KEY = "sb_publishable_l2wj1IeGSfcxgKVjJ28n0w_WK9iHm-j";
const sb = supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

// ì±”í”¼ì–¸ ë¦¬ìŠ¤íŠ¸ëŠ” DBì— JSONBë¡œ ì €ì¥ë˜ì–´ì•¼ í•¨

function getStreakClass(streak){
  const abs=Math.abs(streak);
  if(abs>=7)return 7;
  if(abs===6)return 6;
  if(abs===5)return 5;
  if(abs===4)return 4;
  if(abs===3)return 3;
  if(abs===2)return 2;
  return 1;
}

async function render(){
  const {data:players} = await sb.from('players').select('*');
  const {data:setting} = await sb.from('settings').select('*').single();
  document.getElementById('redName').textContent=setting.red_team_name;
  document.getElementById('blueName').textContent=setting.blue_team_name;
  renderTeam(players.filter(p=>p.team==='red'),'redPlayers','redSummary');
  renderTeam(players.filter(p=>p.team==='blue'),'bluePlayers','blueSummary');
}

function renderTeam(list,containerId,summaryId){
  const container=document.getElementById(containerId);
  container.innerHTML='';
  let w=0,l=0;
  list.forEach(p=>{
    w+=p.wins; l+=p.losses;
    let streakText='',streakClass='';
    if(p.streak>0){streakText=`â­${p.streak}ì—°ìŠ¹`;streakClass=`streak win streak-${getStreakClass(p.streak)}`;}
    else if(p.streak<0){streakText=`ğŸ’€${Math.abs(p.streak)}ì—°íŒ¨`;streakClass=`streak lose streak-${getStreakClass(p.streak)}`;}

    // ìµœê·¼ 10ì „
    let recentHTML='';
    if(p.recent && p.recent.length){
      const arr=p.recent.slice(-10);
      arr.forEach(r=>{
        if(r==='win') recentHTML+='<span class="recent-dot win"></span>';
        else if(r==='lose') recentHTML+='<span class="recent-dot lose"></span>';
        else recentHTML+='<span class="recent-dot empty"></span>';
      });
      while(recentHTML.split('<span').length-1<10) recentHTML+='<span class="recent-dot empty"></span>';
    } else recentHTML='<span class="recent-dot empty"></span>'.repeat(10);

    // ì±”í”¼ì–¸ ì•„ì´ì½˜
    let champHTML='';
    if(p.champions && p.champions.length){
      p.champions.forEach(c=>{
        champHTML+=`<img src="https://ddragon.leagueoflegends.com/cdn/16.3.1/img/champion/${c}.png" alt="${c}">`;
      });
    }

    container.insertAdjacentHTML('beforeend',`
      <div class="member-card">
        <div class="name">${p.name} ${streakText ? `<span class="${streakClass}">${streakText}</span>` : ''}</div>
        <div class="record"><span class="win">ğŸ˜ ${p.wins}ìŠ¹</span> / <span class="lose">ğŸ˜¡ ${p.losses}íŒ¨</span></div>
        <div class="recent">${recentHTML}</div>
        <div class="champions">${champHTML}</div>
      </div>
    `);
  });
  const summaryEl=document.getElementById(summaryId);
  summaryEl.innerHTML=`<span class="win">ğŸ˜ ${w}ìŠ¹</span> / <span class="lose">ğŸ˜¡ ${l}íŒ¨</span>`;
}

render();
sb.channel('realtime')
  .on('postgres_changes',{event:'*',schema:'public',table:'players'},render)
  .on('postgres_changes',{event:'*',schema:'public',table:'settings'},render)
  .subscribe();
</script>
</body>
</html>









































