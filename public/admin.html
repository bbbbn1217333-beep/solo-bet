<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>솔랭 내기 관리자 패널</title>

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      background: #0e0e0e;
      color: #fff;
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #ff3b3b;
      margin-bottom: 20px;
    }

    .wrap {
      max-width: 1000px;
      margin: auto;
      border: 1px solid #333;
      padding: 20px;
      border-radius: 10px;
    }

    .top {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .top input {
      flex: 1;
      padding: 8px;
      background: #111;
      border: 1px solid #444;
      color: #fff;
      border-radius: 6px;
    }

    .teams {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .team {
      border: 1px solid #444;
      padding: 15px;
      border-radius: 8px;
    }

    .team h2 {
      text-align: center;
      margin-bottom: 10px;
    }

    .players {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 8px;
    }

    .players input {
      padding: 6px;
      background: #111;
      border: 1px solid #444;
      color: #fff;
      border-radius: 6px;
    }

    .actions {
      margin-top: 20px;
      text-align: center;
    }

    button {
      padding: 12px 30px;
      background: #ff3b3b;
      border: none;
      color: #fff;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <h1>솔랭 내기 관리자 패널</h1>

  <div class="wrap">
    <div class="top">
      <input id="teamCount" type="number" min="1" max="33" value="5" />
    </div>

    <div class="teams">
      <div class="team">
        <h2>우리팀</h2>
        <div class="players" id="redPlayers"></div>
      </div>

      <div class="team">
        <h2>상대팀</h2>
        <div class="players" id="bluePlayers"></div>
      </div>
    </div>

    <div class="actions">
      <button onclick="apply()">적용</button>
    </div>
  </div>

<script>
  /* ===============================
     Supabase 연결 (단 1번)
  =============================== */
  const SUPABASE_URL = "https://hsvknfmnsehwytnvaiwr.supabase.co";
  const SUPABASE_KEY = "sb_publishable_l2wj1IeGSfcxgKVjJ28n0w_WK9iHm-j";

  const db = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_KEY
  );

  /* ===============================
     DOM
  =============================== */
  const redWrap = document.getElementById("redPlayers");
  const blueWrap = document.getElementById("bluePlayers");
  const teamCountInput = document.getElementById("teamCount");

  /* ===============================
     인풋 생성
  =============================== */
  function createInputs() {
    const count = Number(teamCountInput.value);

    redWrap.innerHTML = "";
    blueWrap.innerHTML = "";

    for (let i = 0; i < count; i++) {
      const r = document.createElement("input");
      r.placeholder = `우리팀 ${i + 1}`;
      redWrap.appendChild(r);

      const b = document.createElement("input");
      b.placeholder = `상대팀 ${i + 1}`;
      blueWrap.appendChild(b);
    }
  }

  teamCountInput.addEventListener("change", createInputs);
  createInputs();

  /* ===============================
     적용 버튼
  =============================== */
  async function apply() {
    const redNames = [...redWrap.querySelectorAll("input")]
      .map(i => i.value.trim())
      .filter(Boolean);

    const blueNames = [...blueWrap.querySelectorAll("input")]
      .map(i => i.value.trim())
      .filter(Boolean);

    if (redNames.length === 0 || blueNames.length === 0) {
      alert("플레이어 이름을 입력해주세요.");
      return;
    }

    // 기존 players 전부 삭제
    await db.from("players").delete().neq("id", "00000000-0000-0000-0000-000000000000");

    // 새 데이터
    const players = [
      ...redNames.map(name => ({
        name,
        team: "red",
        wins: 0,
        losses: 0,
        streak: 0
      })),
      ...blueNames.map(name => ({
        name,
        team: "blue",
        wins: 0,
        losses: 0,
        streak: 0
      }))
    ];

    const { error } = await db.from("players").insert(players);

    if (error) {
      console.error(error);
      alert("저장 실패");
    } else {
      alert("적용 완료");
    }
  }
</script>
</body>
</html>














