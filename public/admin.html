<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì´ë¼ë„¤ ì†”ë­ ë‚´ê¸° ì‹œíŠ¸ì§€ ê´€ë¦¬ììš©</title>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@600;800&family=Orbitron:wght@600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
    :root { 
        --red: #ff3b3b; --blue: #4db8ff; --gold: #ffd369; 
        --neon-red: 0 0 12px rgba(255, 59, 59, 0.7);
        --neon-blue: 0 0 12px rgba(77, 184, 255, 0.7);
        --neon-gold: 0 0 10px rgba(255, 211, 105, 0.5);
    }
    body { margin:0; background:#0e0e0e; color:#fff; font-family:'Pretendard',sans-serif; padding:20px; padding-bottom: 120px; }
    .wrap { width:1450px; margin:0 auto; display:flex; flex-direction:column; gap:20px; }
    
    /* í—¤ë” */
    .admin-header { background:#1a1a1a; padding:25px; border-radius:15px; border:1px solid #333; }
    .top-controls { display:flex; gap:20px; align-items:center; margin-bottom:20px; }
    .top-controls input { padding:12px; background:#000; border:1px solid #444; color:#fff; border-radius:8px; font-size:16px; font-weight:800; }
    
    #redNameInput { border-left: 5px solid var(--red); color: var(--red); box-shadow: var(--neon-red); }
    #blueNameInput { border-left: 5px solid var(--blue); color: var(--blue); box-shadow: var(--neon-blue); }
    
    .count-label { font-size: 16px; color: var(--gold); font-weight: 800; text-shadow: 0 0 8px rgba(255, 211, 105, 0.6); }
    #teamCount { font-weight: 800; color: var(--gold); border: 2px solid var(--gold); background: #000; font-size: 18px; text-align: center; box-shadow: var(--neon-gold); }

    .menu-desc { font-size:14px; color:#ccc; line-height:1.7; background:#252525; padding:18px; border-radius:10px; border-left: 4px solid var(--gold); }
    .menu-desc strong { color: var(--gold); font-size: 16px; text-shadow: 0 0 10px var(--gold); }

    .teams-container { display:flex; gap:25px; }
    .team-box { flex:1; background:#1a1a1a; padding:20px; border-radius:15px; border-top:5px solid #444; }
    .team-box.red { border-color: var(--red); }
    .team-box.blue { border-color: var(--blue); }
    .team-box h2 { font-family:'Orbitron',sans-serif; margin-top:0; font-size:28px; text-align:center; }
    .red-text { color: var(--red); }
    .blue-text { color: var(--blue); }

    .member-list { display:flex; flex-direction:column; gap:20px; max-height:800px; overflow-y:auto; padding: 10px; }
    .member-card { background:#1e1e1e; border-radius:12px; padding:20px; position:relative; }
    .team-box.red .member-card { border: 1.5px solid var(--red); box-shadow: var(--neon-red); }
    .team-box.blue .member-card { border: 1.5px solid var(--blue); box-shadow: var(--neon-blue); }

    .name-row { display:flex; gap:12px; margin-bottom:18px; }
    .name-row input { flex:1; padding:12px; background:#000; color:#fff; border-radius:8px; font-size:15px; font-weight: 700; }
    .team-box.red .name-row input { border: 1px solid var(--red); box-shadow: 0 0 5px rgba(255, 59, 59, 0.4); }
    .team-box.blue .name-row input { border: 1px solid var(--blue); box-shadow: 0 0 5px rgba(77, 184, 255, 0.4); }

    .history-editor { display:grid; grid-template-columns: repeat(5, 1fr); gap:10px; background:#0c0c0c; padding:12px; border-radius:10px; }
    .history-item { display:flex; flex-direction:column; gap:6px; align-items:center; padding:10px 5px; background:#1e1e1e; border-radius:8px; border:1px solid #333; }
    .history-item span { font-size:13px; color: var(--gold); font-weight:900; text-shadow: 0 0 5px rgba(255, 211, 105, 0.5); }

    .champ-input { 
        width:92%; background:#000; border: 1px solid var(--gold); color:#fff; text-align:center; padding:8px 0; border-radius:5px; font-size:11.5px; font-weight: 600;
        box-shadow: 0 0 8px rgba(255, 211, 105, 0.2);
        white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    
    .btn-toggle { width:100%; padding:8px 0; font-size:12px; font-weight:900; border:none; border-radius:4px; cursor:pointer; }
    .btn-toggle.win { background: var(--gold); color: #000; }
    .btn-toggle.lose { background: var(--red); color: #fff; }

    .btn-apply { 
        position: fixed; bottom: 30px; right: 30px; z-index: 1000;
        width: 280px; height: 70px; font-size:24px; font-weight:800; 
        background: var(--red); color:#fff; border:none; border-radius:15px; 
        cursor:pointer; box-shadow: 0 0 25px rgba(255, 59, 59, 0.6); transition: 0.2s;
    }
    .btn-apply:hover { background:#ff1a1a; transform: scale(1.05); }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }
</style>
</head>
<body>

<div class="wrap">
    <div class="admin-header">
        <div class="top-controls">
            <input id="redNameInput" oninput="updateTeamNames()" value="ë ˆë“œ íŒ€">
            <input id="blueNameInput" oninput="updateTeamNames()" value="ë¸”ë£¨ íŒ€">
            <label class="count-label">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ì°¸ì—¬ ì¸ì› (1~33): </label>
            <input id="teamCount" type="number" min="1" max="33" value="5" onchange="rebuild()" style="width:80px;">
        </div>
        <div class="menu-desc">
            <strong>ğŸ’¡ ê´€ë¦¬ì íŒ¨ë„ ì‚¬ìš©ë²•</strong><br>
            1. <strong>ë°©ì†¡ ë‹‰ë„¤ì„</strong>ì€ í™”ë©´ì— í‘œì‹œë  ì´ë¦„, <strong>ë¡¤ ë‹‰ë„¤ì„</strong>ì€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ì‹¤ì œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.<br>
            2. <strong>ìµœê·¼ 10íŒ ì„¤ì •</strong>: ì±”í”¼ì–¸ ì´ë¦„ì„ ì…ë ¥í•˜ê³  ìŠ¹ë¦¬/íŒ¨ë°° ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìƒíƒœë¥¼ ë³€ê²½í•˜ì„¸ìš”.<br>
            3. <strong>ë¹ ë¥¸ ì´ë™</strong>: ì…ë ¥ì°½ì—ì„œ ì—”í„°(Enter)ë¥¼ ëˆ„ë¥´ë©´ ë‹¤ìŒ í”Œë ˆì´ì–´ ë˜ëŠ” ë‹¤ìŒ í•­ëª©ìœ¼ë¡œ ìë™ í¬ì»¤ìŠ¤ë©ë‹ˆë‹¤.
        </div>
    </div>

    <div class="teams-container">
        <div class="team-box red">
            <h2 id="redTitle" class="red-text">ë ˆë“œ íŒ€</h2>
            <div id="redPlayers" class="member-list"></div>
        </div>
        <div class="team-box blue">
            <h2 id="blueTitle" class="blue-text">ë¸”ë£¨ íŒ€</h2>
            <div id="bluePlayers" class="member-list"></div>
        </div>
    </div>
</div>

<button class="btn-apply" onclick="applyToSupabase()">ì†¡ì¶œ í™”ë©´ ë°˜ì˜</button>

<script>
// Supabase ì„¤ì •
const SUPABASE_URL = "https://hsvknfmnsehwytnvaiwr.supabase.co";
const SUPABASE_KEY = "sb_publishable_l2wj1IeGSfcxgKVjJ28n0w_WK9iHm-j";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

function updateTeamNames() {
    document.getElementById('redTitle').innerText = document.getElementById('redNameInput').value;
    document.getElementById('blueTitle').innerText = document.getElementById('blueNameInput').value;
}

function createMemberCard(team) {
    const card = document.createElement('div');
    card.className = 'member-card';
    let historyHTML = '';
    for(let i=1; i<=10; i++) {
        historyHTML += `
            <div class="history-item">
                <span>${i}íŒ</span>
                <input type="text" class="champ-input enter-target" placeholder="ì±”í”¼ì–¸">
                <button class="btn-toggle win" onclick="toggleResult(this)">ğŸ˜ ìŠ¹ë¦¬</button>
            </div>
        `;
    }
    card.innerHTML = `
        <div class="name-row">
            <input class="nick-disp enter-target" placeholder="ë°©ì†¡ ë‹‰ë„¤ì„">
            <input class="nick-riot enter-target" placeholder="ë¡¤ ë‹‰ë„¤ì„">
        </div>
        <div class="history-editor">${historyHTML}</div>
    `;
    card.dataset.team = team;
    return card;
}

function toggleResult(btn) {
    if(btn.innerText.includes('ìŠ¹ë¦¬')) {
        btn.innerText = 'ğŸ˜¡ íŒ¨ë°°'; btn.className = 'btn-toggle lose';
    } else {
        btn.innerText = 'ğŸ˜ ìŠ¹ë¦¬'; btn.className = 'btn-toggle win';
    }
}

// ì—”í„° í‚¤ë¡œ ë‹¤ìŒ ì…ë ¥ì°½ ì´ë™
document.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        const targets = Array.from(document.querySelectorAll('.enter-target'));
        const currIdx = targets.indexOf(e.target);
        if (currIdx > -1 && currIdx < targets.length - 1) {
            targets[currIdx + 1].focus();
        }
    }
});

function rebuild() {
    const redWrap = document.getElementById('redPlayers');
    const blueWrap = document.getElementById('bluePlayers');
    const count = Number(document.getElementById('teamCount').value);
    redWrap.innerHTML = ''; blueWrap.innerHTML = '';
    for(let i=0; i<count; i++) {
        redWrap.appendChild(createMemberCard('red'));
        blueWrap.appendChild(createMemberCard('blue'));
    }
}

// [í•µì‹¬] Supabaseë¡œ ë°ì´í„° ì¼ê´„ ì†¡ì¶œ (ìµœì í™” ë²„ì „)
async function applyToSupabase() {
    const players = [];
    const redTeamName = document.getElementById('redNameInput').value;
    const blueTeamName = document.getElementById('blueNameInput').value;
    const memberCount = Number(document.getElementById('teamCount').value);

    // ëª¨ë“  ë©¤ë²„ ì¹´ë“œ ë°ì´í„° ìˆ˜ì§‘
    document.querySelectorAll('.member-card').forEach(card => {
        const name = card.querySelector('.nick-disp').value.trim();
        const riotId = card.querySelector('.nick-riot').value.trim();
        
        // ë°©ì†¡ ë‹‰ë„¤ì„ì´ ìˆëŠ” ê²½ìš°ë§Œ ìˆ˜ì§‘
        if(!name) return;

        const historyItems = card.querySelectorAll('.history-item');
        const recent = [], champs = [];
        
        historyItems.forEach(item => {
            recent.push(item.querySelector('.btn-toggle').innerText.includes('ìŠ¹ë¦¬') ? 'win' : 'lose');
            champs.push(item.querySelector('.champ-input').value.trim());
        });

        players.push({ 
            name, 
            riot_id: riotId, 
            team: card.dataset.team, 
            wins: recent.filter(r => r === 'win').length, 
            losses: recent.filter(r => r === 'lose').length, 
            recent, 
            champions: champs 
        });
    });

    try {
        // 1. ì„¤ì • ì •ë³´ ì—…ë°ì´íŠ¸ (API Call 1)
        const { error: setErr } = await sb.from('settings').upsert({ 
            id: 1, 
            red_team_name: redTeamName, 
            blue_team_name: blueTeamName, 
            member_count: memberCount 
        });
        if (setErr) throw setErr;

        // 2. ê¸°ì¡´ í”Œë ˆì´ì–´ ì‚­ì œ (API Call 2)
        // ì•ˆì „í•˜ê²Œ ì „ì²´ ì‚­ì œ í›„ ì¬ì‚½ì…í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤ì‹œê°„ ë™ê¸°í™” ì˜¤ë¥˜ ë°©ì§€
        const { error: delErr } = await sb.from('players').delete().neq('name', '___dummy___');
        if (delErr) throw delErr;

        // 3. ìƒˆ í”Œë ˆì´ì–´ ëª©ë¡ ì¼ê´„ ì‚½ì… (API Call 3)
        if (players.length > 0) {
            const { error: insErr } = await sb.from('players').insert(players);
            if (insErr) throw insErr;
        }

        alert('âœ… ì†¡ì¶œ í™”ë©´ì— ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
    } catch (e) { 
        console.error(e);
        alert('âŒ ì˜¤ë¥˜ ë°œìƒ: ' + e.message); 
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë¦¬ìŠ¤íŠ¸ ìƒì„±
rebuild();
</script>
</body>
</html>























