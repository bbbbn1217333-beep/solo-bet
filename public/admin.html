<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì´ë¼ë„¤ ì†”ë­ ë‚´ê¸° ì‹œíŠ¸ì§€ ê´€ë¦¬ììš©</title>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@600;800&family=Orbitron:wght@600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
    :root { 
        --red: #ff3b3b; --blue: #4db8ff; --gold: #ffd369; 
        --emerald: #2ecc71; 
        --neon-red: 0 0 15px rgba(255, 59, 59, 0.8);
        --neon-blue: 0 0 15px rgba(77, 184, 255, 0.8);
        --neon-gold: 0 0 12px rgba(255, 211, 105, 0.7);
        --neon-emerald: 0 0 12px rgba(46, 204, 113, 0.7);
    }
    body { margin:0; background:#0e0e0e; color:#fff; font-family:'Pretendard',sans-serif; padding:20px; padding-bottom: 120px; }
    .wrap { width:1450px; margin:0 auto; display:flex; flex-direction:column; gap:20px; }
    
    .admin-header { background:#1a1a1a; padding:25px; border-radius:15px; border:1px solid #333; }
    .top-controls { display:flex; gap:20px; align-items:flex-end; margin-bottom:20px; }
    
    .header-group { display:flex; flex-direction:column; gap:8px; }
    .header-group label { font-size:12px; font-weight:800; color:var(--gold); text-shadow: 0 0 5px rgba(255,211,105,0.5); margin-left:2px; }
    
    .top-controls input { padding:12px; background:#000; border-radius:8px; font-size:16px; font-weight:800; outline:none; transition:0.2s; }
    #redNameInput { border: 2px solid var(--red); color: var(--red); box-shadow: var(--neon-red); }
    #blueNameInput { border: 2px solid var(--blue); color: var(--blue); box-shadow: var(--neon-blue); }
    
    #teamCount { font-weight: 800; color: var(--gold); border: 2px solid var(--gold); background: #000; font-size: 18px; text-align: center; box-shadow: var(--neon-gold); width:80px; }

    .timer-input-wrap { display: flex; align-items: center; gap: 10px; background: #000; padding: 10px 15px; border-radius: 10px; border: 2px solid var(--gold); box-shadow: var(--neon-gold); height: 46px; box-sizing: border-box; }
    #endDateTime { background: transparent; border: none; color: var(--gold); font-family: 'Pretendard'; font-weight: 800; font-size: 15px; outline: none; color-scheme: dark; }

    .btn-load-data { height:46px; padding:0 20px; background:#333; color:#fff; border:1px solid #555; border-radius:8px; cursor:pointer; font-weight:800; transition:0.2s; }
    .btn-load-data:hover { background:var(--gold); color:#000; border-color:var(--gold); box-shadow: var(--neon-gold); }

    .menu-desc { font-size:14px; color:#ccc; line-height:1.7; background:#252525; padding:18px; border-radius:10px; border: 1px solid var(--gold); box-shadow: inset 0 0 10px rgba(255,211,105,0.1), var(--neon-gold); margin-top: 10px; }
    .menu-desc strong { color: var(--gold); font-size: 16px; text-shadow: 0 0 10px var(--gold); }

    .teams-container { display:flex; gap:25px; }
    .team-box { flex:1; background:#1a1a1a; padding:20px; border-radius:15px; border-top:5px solid #444; }
    .team-box.red { border-color: var(--red); }
    .team-box.blue { border-color: var(--blue); }
    .team-box h2 { font-family:'Orbitron',sans-serif; margin-top:0; font-size:28px; text-align:center; }
    .red-text { color: var(--red); text-shadow: var(--neon-red); }
    .blue-text { color: var(--blue); text-shadow: var(--neon-blue); }

    .member-list { display:flex; flex-direction:column; gap:20px; max-height:800px; overflow-y:auto; padding: 10px; }
    .member-card { background:#1e1e1e; border-radius:12px; padding:20px; border: 2px solid #333; position: relative; }
    
    .name-row { display:flex; gap:15px; margin-bottom:15px; align-items: flex-end; }
    .name-row input, .name-row select { padding:10px; background:#000; color:#fff; border-radius:6px; font-size:13px; font-weight: 700; border: 2px solid #444; outline:none; transition: 0.2s; }
    
    .team-box.red .nick-disp, .team-box.red .nick-riot { border-color: var(--red); box-shadow: var(--neon-red); }
    .team-box.blue .nick-disp, .team-box.blue .nick-riot { border-color: var(--blue); box-shadow: var(--neon-blue); }
    .tier-select, .lp-input { border-color: var(--gold) !important; box-shadow: var(--neon-gold); color: var(--gold) !important; }

    .score-input-wrap { display:flex; flex-direction:column; gap:5px; width:55px; margin-left: 5px; }
    .score-input-wrap label { font-size:11px; font-weight:900; text-align:center; }
    .score-input { width: 100%; padding:10px 0 !important; text-align:center; border-radius:6px; font-size:16px !important; outline: none; }
    .win-val { border: 2px solid var(--gold) !important; box-shadow: var(--neon-gold); color: var(--gold) !important; }
    .lose-val { border: 2px solid var(--red) !important; box-shadow: var(--neon-red); color: var(--red) !important; }

    .history-editor { display:grid; grid-template-columns: repeat(5, 1fr); gap:10px; background:#0c0c0c; padding:15px; border-radius:10px; border: 1px solid #333; }
    .history-item { display:flex; flex-direction:column; gap:6px; align-items:center; padding:10px 5px; background:#1e1e1e; border-radius:8px; border: 1px solid #444; }
    .history-item span { font-size:12px; color: var(--gold); font-weight:900; }
    .champ-input { width:92%; background:#000; border: 2px solid var(--gold); color:#fff; text-align:center; padding:8px 0; border-radius:5px; font-size:11.5px; font-weight: 600; box-shadow: var(--neon-gold); outline: none; }
    
    .btn-toggle { width:100%; padding:8px 0; font-size:11px; font-weight:900; border:none; border-radius:4px; cursor:pointer; }
    .btn-toggle.win { background: var(--gold); color: #000; }
    .btn-toggle.lose { background: var(--red); color: #fff; }
    .btn-toggle.ing { background: var(--emerald); color: #fff; }

    .btn-apply { position: fixed; bottom: 30px; right: 30px; z-index: 1000; width: 280px; height: 70px; font-size:24px; font-weight:800; background: var(--red); color:#fff; border:none; border-radius:15px; cursor:pointer; box-shadow: 0 0 25px rgba(255, 59, 59, 0.6); transition: 0.2s; }
</style>
</head>
<body>

<div class="wrap">
    <div class="admin-header">
        <div class="top-controls">
            <div class="header-group"><label>ğŸš© ë ˆë“œ íŒ€ ëª…ì¹­</label><input id="redNameInput" oninput="updateTeamNames()" placeholder="ë ˆë“œ íŒ€"></div>
            <div class="header-group"><label>ğŸš© ë¸”ë£¨ íŒ€ ëª…ì¹­</label><input id="blueNameInput" oninput="updateTeamNames()" placeholder="ë¸”ë£¨ íŒ€"></div>
            <div class="header-group"><label>â° ëª©í‘œ ì¢…ë£Œ ì‹œê°„</label><div class="timer-input-wrap"><input id="endDateTime" type="datetime-local"></div></div>
            <div class="header-group"><label>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ì¸ì›</label><input id="teamCount" type="number" min="1" max="33" value="5" onchange="rebuild()"></div>
            <button class="btn-load-data" onclick="loadData()">ğŸ”„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
        </div>
        <div class="menu-desc"><strong>ğŸ“‹ ê´€ë¦¬ ë§¤ë‰´ì–¼</strong><br>â€¢ í‹°ì–´ ì„ íƒ ì‹œ <strong>í•œê¸€</strong>ë¡œ í‘œì‹œë˜ë©°, ì†¡ì¶œ í™”ë©´ì—ë„ í•œê¸€ í‹°ì–´ëª…ì´ ë°˜ì˜ë©ë‹ˆë‹¤.</div>
    </div>

    <div class="teams-container">
        <div class="team-box red"><h2 id="redTitle" class="red-text">ë ˆë“œ íŒ€</h2><div id="redPlayers" class="member-list"></div></div>
        <div class="team-box blue"><h2 id="blueTitle" class="blue-text">ë¸”ë£¨ íŒ€</h2><div id="bluePlayers" class="member-list"></div></div>
    </div>
</div>

<button class="btn-apply" onclick="applyToSupabase()">ì†¡ì¶œ í™”ë©´ ë°˜ì˜</button>

<script>
const SUPABASE_URL = "https://hsvknfmnsehwytnvaiwr.supabase.co";
const SUPABASE_KEY = "sb_publishable_l2wj1IeGSfcxgKVjJ28n0w_WK9iHm-j";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const TIER_MAP = {
    "CHALLENGER": "ì±Œë¦°ì €", "GRANDMASTER": "ê·¸ëœë“œë§ˆìŠ¤í„°", "MASTER": "ë§ˆìŠ¤í„°",
    "DIAMOND 1": "ë‹¤ì´ì•„ëª¬ë“œ 1", "DIAMOND 2": "ë‹¤ì´ì•„ëª¬ë“œ 2", "DIAMOND 3": "ë‹¤ì´ì•„ëª¬ë“œ 3", "DIAMOND 4": "ë‹¤ì´ì•„ëª¬ë“œ 4",
    "EMERALD 1": "ì—ë©”ë„ë“œ 1", "EMERALD 2": "ì—ë©”ë„ë“œ 2", "EMERALD 3": "ì—ë©”ë„ë“œ 3", "EMERALD 4": "ì—ë©”ë„ë“œ 4",
    "PLATINUM 1": "í”Œë˜í‹°ë„˜ 1", "PLATINUM 2": "í”Œë˜í‹°ë„˜ 2", "PLATINUM 3": "í”Œë˜í‹°ë„˜ 3", "PLATINUM 4": "í”Œë˜í‹°ë„˜ 4",
    "GOLD 1": "ê³¨ë“œ 1", "GOLD 2": "ê³¨ë“œ 2", "GOLD 3": "ê³¨ë“œ 3", "GOLD 4": "ê³¨ë“œ 4",
    "SILVER 1": "ì‹¤ë²„ 1", "SILVER 2": "ì‹¤ë²„ 2", "SILVER 3": "ì‹¤ë²„ 3", "SILVER 4": "ì‹¤ë²„ 4",
    "BRONZE 1": "ë¸Œë¡ ì¦ˆ 1", "BRONZE 2": "ë¸Œë¡ ì¦ˆ 2", "BRONZE 3": "ë¸Œë¡ ì¦ˆ 3", "BRONZE 4": "ë¸Œë¡ ì¦ˆ 4",
    "IRON 1": "ì•„ì´ì–¸ 1", "IRON 2": "ì•„ì´ì–¸ 2", "IRON 3": "ì•„ì´ì–¸ 3", "IRON 4": "ì•„ì´ì–¸ 4",
    "UNRANKED": "ì–¸ë­í¬"
};

document.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        const focusable = Array.from(document.querySelectorAll('input, select'));
        const index = focusable.indexOf(e.target);
        if (index > -1 && index < focusable.length - 1) { e.preventDefault(); focusable[index + 1].focus(); }
    }
});

function updateTeamNames() {
    document.getElementById('redTitle').innerText = document.getElementById('redNameInput').value || 'ë ˆë“œ íŒ€';
    document.getElementById('blueTitle').innerText = document.getElementById('blueNameInput').value || 'ë¸”ë£¨ íŒ€';
}

function toggleResult(btn) {
    if (btn.innerText.includes('ìŠ¹ë¦¬')) { btn.innerText = 'ğŸ˜¡ íŒ¨ë°°'; btn.className = 'btn-toggle lose'; }
    else if (btn.innerText.includes('íŒ¨ë°°')) { btn.innerText = 'ğŸ•’ ì§„í–‰'; btn.className = 'btn-toggle ing'; }
    else { btn.innerText = 'ğŸ˜ ìŠ¹ë¦¬'; btn.className = 'btn-toggle win'; }
}

function createMemberCard(team, data = null) {
    const card = document.createElement('div');
    card.className = 'member-card';
    card.dataset.team = team;

    let historyHTML = '';
    for(let i=0; i<10; i++) {
        const champ = data?.champions?.[i] || '';
        const res = data?.recent?.[i] || 'ing';
        const resText = res === 'win' ? 'ğŸ˜ ìŠ¹ë¦¬' : (res === 'lose' ? 'ğŸ˜¡ íŒ¨ë°°' : 'ğŸ•’ ì§„í–‰');
        const resClass = res === 'win' ? 'win' : (res === 'lose' ? 'lose' : 'ing');
        historyHTML += `<div class="history-item"><span>${i+1}íŒ</span><input type="text" class="champ-input" placeholder="ì±”í”¼ì–¸" value="${champ}"><button class="btn-toggle ${resClass}" onclick="toggleResult(this)">${resText}</button></div>`;
    }

    let currentTierEng = "UNRANKED";
    let currentLP = "";
    if (data?.tier) {
        const parts = data.tier.split(' - ');
        // ì €ì¥ëœ ë°ì´í„°ê°€ í•œê¸€ì¼ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ì—­ì¶”ì 
        const foundEng = Object.keys(TIER_MAP).find(key => TIER_MAP[key] === parts[0]);
        currentTierEng = foundEng || "UNRANKED";
        currentLP = parts[1] ? parts[1].replace('LP', '') : "";
    }

    const tierOptions = Object.entries(TIER_MAP).map(([eng, kor]) => `<option value="${eng}" ${currentTierEng === eng ? 'selected' : ''}>${kor}</option>`).join('');

    card.innerHTML = `
        <div class="name-row">
            <div class="input-group"><label>ë°©ì†¡ ë‹‰ë„¤ì„</label><input class="nick-disp" placeholder="ë‹‰ë„¤ì„" value="${data?.name || ''}"></div>
            <div class="input-group"><label>ë¡¤ ë‹‰ë„¤ì„</label><input class="nick-riot" placeholder="ë¡¤ ë‹‰ë„¤ì„" value="${data?.riot_id || ''}"></div>
            <div class="input-group" style="flex:1.5"><label>í‹°ì–´ ì„ íƒ</label><select class="tier-select">${tierOptions}</select></div>
            <div class="input-group" style="width:70px; flex:none;"><label>LP</label><input class="lp-input" placeholder="0" value="${currentLP}"></div>
            <div class="score-input-wrap" style="margin-left:15px;"><label style="color:var(--gold)">ìŠ¹ë¦¬</label><input class="score-input win-val" value="${data?.wins ?? ''}"></div>
            <div class="score-input-wrap"><label style="color:var(--red)">íŒ¨ë°°</label><input class="score-input lose-val" value="${data?.losses ?? ''}"></div>
        </div>
        <div class="history-editor">${historyHTML}</div>`;
    return card;
}

function rebuild(dataList = null) {
    const redWrap = document.getElementById('redPlayers');
    const blueWrap = document.getElementById('bluePlayers');
    const count = Number(document.getElementById('teamCount').value);
    redWrap.innerHTML = ''; blueWrap.innerHTML = '';
    for(let i=0; i<count; i++) {
        redWrap.appendChild(createMemberCard('red', dataList?.filter(p => p.team === 'red')[i]));
        blueWrap.appendChild(createMemberCard('blue', dataList?.filter(p => p.team === 'blue')[i]));
    }
}

async function loadData() {
    try {
        const { data: sData } = await sb.from('settings').select('*').eq('id', 1).single();
        if (sData) {
            document.getElementById('redNameInput').value = sData.red_team_name;
            document.getElementById('blueNameInput').value = sData.blue_team_name;
            document.getElementById('teamCount').value = sData.member_count;
            if(sData.timer_end_at) {
                const date = new Date(sData.timer_end_at);
                document.getElementById('endDateTime').value = new Date(date.getTime() - date.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            }
            updateTeamNames();
        }
        const { data: pData } = await sb.from('players').select('*').order('created_at', { ascending: true });
        rebuild(pData);
    } catch (e) { rebuild(); }
}

async function applyToSupabase() {
    const players = [];
    document.querySelectorAll('.member-card').forEach(card => {
        const name = card.querySelector('.nick-disp').value.trim();
        if(!name) return;
        const recent = [], champs = [];
        card.querySelectorAll('.history-item').forEach(item => {
            const btn = item.querySelector('.btn-toggle');
            recent.push(btn.innerText.includes('ìŠ¹ë¦¬') ? 'win' : (btn.innerText.includes('íŒ¨ë°°') ? 'lose' : 'ing'));
            champs.push(item.querySelector('.champ-input').value.trim() || 'None');
        });
        
        // ì¤‘ìš”: ì†¡ì¶œ í™”ë©´ì— í•œê¸€ë¡œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ TIER_MAPì—ì„œ í•œê¸€ ì´ë¦„ì„ ê°€ì ¸ì™€ì„œ ì €ì¥
        const tierEng = card.querySelector('.tier-select').value;
        const tierKor = TIER_MAP[tierEng]; 
        const lpVal = card.querySelector('.lp-input').value.trim();
        const fullTier = lpVal ? `${tierKor} - ${lpVal}LP` : tierKor;

        players.push({ 
            name, team: card.dataset.team, riot_id: card.querySelector('.nick-riot').value.trim(),
            tier: fullTier, 
            wins: card.querySelector('.win-val').value !== '' ? Number(card.querySelector('.win-val').value) : recent.filter(r=>r==='win').length, 
            losses: card.querySelector('.lose-val').value !== '' ? Number(card.querySelector('.lose-val').value) : recent.filter(r=>r==='lose').length,
            recent, champions: champs 
        });
    });
    try {
        await sb.from('settings').upsert({ id: 1, red_team_name: redNameInput.value, blue_team_name: blueNameInput.value, member_count: Number(teamCount.value), timer_end_at: document.getElementById('endDateTime').value ? new Date(document.getElementById('endDateTime').value).toISOString() : null });
        await sb.from('players').delete().neq('id', '00000000-0000-0000-0000-000000000000');
        if(players.length > 0) await sb.from('players').insert(players);
        alert('âœ… í•œê¸€ í‹°ì–´ ë°ì´í„°ê°€ ì†¡ì¶œ í™”ë©´ì— ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤!');
    } catch (e) { alert('âŒ ì˜¤ë¥˜: ' + e.message); }
}
loadData();
</script>
</body>
</html>























